<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>웰스토리 API 프론트엔드</title>
    <link rel="stylesheet" href="/style.css">
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="header-left">
                <h1>🍽️ Welplan</h1>
                <p>니1가 원하는 웰스토리 메뉴보기</p>
            </div>
            
            <!-- Tab Navigation in Header -->
            <div class="header-navigation">
                <button class="header-tab-btn" onclick="switchTab('restaurants', this)">🍽️ 식당 설정</button>
                <button class="header-tab-btn" onclick="switchTab('takein', this)">🍴 테이크 인</button>
                <button class="header-tab-btn" onclick="switchTab('takeout', this)">📦 테이크 아웃</button>
                <button class="header-tab-btn active" onclick="switchTab('gallery', this)">📸 갤러리</button>
                <button class="header-tab-btn" onclick="switchTab('system', this)">⚙️ 설정</button>
            </div>
        </div>

        <div class="content">
            <div class="status info">📱 <strong>베타 버전</strong> - 캐싱으로 첫 접속시 느릴 수 있음</div>

            <!-- Restaurant Selection Tab -->
            <div id="restaurants-tab" class="tab-content">
                <div class="status info">✅ 식당 선택 후 상단 탭에서 메뉴 확인</div>
                <!-- Restaurant Search Section -->
                <div class="section">
                    <h2>🔍 식당 검색</h2>
                    <div id="searchStatus"></div>
                    <div class="form-inline">
                        <div class="form-group">
                            <label for="restaurantSearch">식당명:</label>
                            <input type="text" id="restaurantSearch" placeholder="식당명을 입력하세요">
                        </div>
                        <button class="btn" onclick="searchRestaurants()">검색</button>
                    </div>
                    <div id="restaurantResults" class="results"></div>
                </div>

                <!-- Selected Restaurants Section -->
                <div class="section">
                    <h2>📍 선택된 식당</h2>
                    <div id="selectedRestaurantsStatus"></div>
                    <div id="selectedRestaurantsList" class="results">
                        <p>선택된 식당이 없습니다. 위에서 식당을 검색하고 선택하세요.</p>
                    </div>
                </div>
            </div>

            <!-- Take In Meals Tab -->
            <div id="takein-tab" class="tab-content">
                <!-- Meals Section -->
                <div class="section">
                    <h2>🍴 테이크 인 메뉴</h2>
                    <div class="status info">💡 헤더 클릭으로 정렬 | P-Score: 다이어트 점수 (낮을수록 좋음)</div>
                    <div id="takeinMealsStatus"></div>
                    <div class="meal-controls">
                        <div class="meal-controls-row">
                            <div class="form-group">
                                <label for="takeinMealDate">📅 날짜</label>
                                <input type="date" id="takeinMealDate" value="" onchange="onTakeinMealDateChange()">
                            </div>
                            <div class="form-group">
                                <label for="takeinMealTimeId">🕐 시간</label>
                                <select id="takeinMealTimeId" onchange="onTakeinMealTimeChange()">
                                    <option value="">식사 시간 선택</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="meal-filters">
                            <div class="filter-title">🎯 필터 옵션</div>
                            <div class="filter-options">
                                <label class="filter-option">
                                    <input type="checkbox" id="takeinFilterMainOnly" onchange="onTakeinFilterChange()"> 
                                    <span>메인 메뉴만</span>
                                </label>
                                <label class="filter-option">
                                    <input checked type="checkbox" id="takeinFilterExcludeOptional" onchange="onTakeinFilterChange()"> 
                                    <span>추가찬 제외</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile Table Controls -->
                    <div class="mobile-table-controls">
                        <span>📱 모바일 보기:</span>
                        <label>
                            <input type="radio" name="takeinTableView" value="card" checked onchange="toggleMobileTableView('takein', this.value)"> 카드형
                        </label>
                        <label>
                            <input type="radio" name="takeinTableView" value="scroll" onchange="toggleMobileTableView('takein', this.value)"> 스크롤 테이블
                        </label>
                    </div>
                    
                    <div id="takeinMealsResults" class="results"></div>
                </div>
            </div>

            <!-- Take Out Meals Tab -->
            <div id="takeout-tab" class="tab-content">
                <div class="status info">🚧 개선 예정: 음료수 필터, 코인 계산</div>

                <!-- Meals Section -->
                <div class="section">
                    <h2>📦 테이크 아웃 메뉴</h2>
                    <div class="status info">💡 헤더 클릭으로 정렬 | P-Score: 다이어트 점수 (낮을수록 좋음)</div>
                    <div id="takeoutMealsStatus"></div>
                    <div class="meal-controls">
                        <div class="form-group restaurant-select">
                            <label for="takeoutRestaurantSelect">🏪 식당 선택</label>
                            <select id="takeoutRestaurantSelect" onchange="onTakeoutRestaurantChange()">
                                <option value="">테이크 아웃 식당을 선택하세요</option>
                            </select>
                        </div>
                        
                        <div class="meal-controls-row">
                            <div class="form-group">
                                <label for="takeoutMealDate">📅 날짜</label>
                                <input type="date" id="takeoutMealDate" value="" onchange="onTakeoutMealDateChange()">
                            </div>
                            <div class="form-group">
                                <label for="takeoutMealTimeId">🕐 시간</label>
                                <select id="takeoutMealTimeId" onchange="onTakeoutMealTimeChange()">
                                    <option value="">식사 시간 선택</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="meal-filters">
                            <div class="filter-title">🎯 필터 옵션</div>
                            <div class="filter-options">
                                <label class="filter-option">
                                    <input type="checkbox" id="takeoutFilterDrinks" onchange="onTakeoutFilterDrinksChange()" checked> 
                                    <span>음료수 제외</span>
                                </label>
                            </div>
                        </div>
                    </div>
                    
                    <!-- Mobile Table Controls -->
                    <div class="mobile-table-controls">
                        <span>📱 모바일 보기:</span>
                        <label>
                            <input type="radio" name="takeoutTableView" value="card" checked onchange="toggleMobileTableView('takeout', this.value)"> 카드형
                        </label>
                        <label>
                            <input type="radio" name="takeoutTableView" value="scroll" onchange="toggleMobileTableView('takeout', this.value)"> 스크롤 테이블
                        </label>
                    </div>
                    
                    <div id="takeoutMealsResults" class="results"></div>
                </div>
            </div>

            <!-- Gallery Tab -->
            <div id="gallery-tab" class="tab-content active">
                <!-- Gallery Controls -->
                <div class="section">
                    <h2>📸 메뉴 갤러리</h2>
                    <div id="galleryStatus"></div>
                    
                    <div class="form-inline">
                        <div class="form-group">
                            <input type="date" id="galleryDate" value="" onchange="onGalleryDateChange()">
                        </div>
                        <div class="form-group">
                            <select id="galleryMealTimeId" onchange="onGalleryMealTimeChange()">
                                <option value="">식사 시간 선택</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <input type="text" id="gallerySearch" placeholder="메뉴명 검색..." onkeyup="filterGallery()">
                        </div>
                        <div class="form-group">
                            <select id="gallerySortBy" onchange="sortGallery()">
                                <option value="">정렬 기준</option>
                                <option value="pscore-asc">P-Score 낮은순</option>
                                <option value="pscore-desc">P-Score 높은순</option>
                                <option value="name-asc">메뉴명 A-Z</option>
                                <option value="name-desc">메뉴명 Z-A</option>
                                <option value="restaurant-asc">식당명 A-Z</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>
                                <input type="checkbox" id="galleryShowLabels" checked onchange="toggleGalleryLabels()"> 
                                메뉴명 표시
                            </label>
                        </div>
                    </div>
                    
                    <div class="gallery-controls">
                        <span class="gallery-count" id="galleryCount">0개 이미지</span>
                    </div>
                    
                    <div id="galleryGrid" class="gallery-grid"></div>
                </div>
            </div>

            <!-- System Status Tab -->
            <div id="system-tab" class="tab-content">
                <!-- P-Score Settings Section -->
                <div class="section">
                    <h2>⚖️ P-Score 설정</h2>
                    <div class="status info">⚖️ P-Score 가중치 조정 (낮을수록 다이어트에 유리)</div>
                    
                    <div class="status info">
                        <strong>현재 공식:</strong> P-Score = (칼로리×<span id="currentCalorieWeight">0.1</span>) + (탄수화물×<span id="currentCarbWeight">0.8</span>) + (당분×<span id="currentSugarWeight">2.0</span>) + (지방×<span id="currentFatWeight">1.5</span>) - (단백질×<span id="currentProteinWeight">0.5</span>)
                    </div>
                    
                    <div class="form-inline">
                        <div class="form-group">
                            <label for="calorieWeight">칼로리 가중치:</label>
                            <input type="number" id="calorieWeight" min="0" max="5" step="0.1" value="0.1" onchange="updatePScoreWeights()">
                        </div>
                        <div class="form-group">
                            <label for="carbWeight">탄수화물 가중치:</label>
                            <input type="number" id="carbWeight" min="0" max="5" step="0.1" value="0.8" onchange="updatePScoreWeights()">
                        </div>
                        <div class="form-group">
                            <label for="sugarWeight">당분 가중치:</label>
                            <input type="number" id="sugarWeight" min="0" max="10" step="0.1" value="2.0" onchange="updatePScoreWeights()">
                        </div>
                    </div>
                    <div class="form-inline">
                        <div class="form-group">
                            <label for="fatWeight">지방 가중치:</label>
                            <input type="number" id="fatWeight" min="0" max="10" step="0.1" value="1.5" onchange="updatePScoreWeights()">
                        </div>
                        <div class="form-group">
                            <label for="proteinWeight">단백질 보너스:</label>
                            <input type="number" id="proteinWeight" min="0" max="5" step="0.1" value="0.5" onchange="updatePScoreWeights()">
                        </div>
                        <div class="form-group">
                            <button class="btn" onclick="resetPScoreWeights()">기본값 복원</button>
                        </div>
                    </div>
                </div>

                <div class="section">
                    <h2>🔐 시스템 상태</h2>
                    <div class="status info">⚠️ 서버 부하 방지를 위해 적당히 사용</div>
                    <div id="loginStatus"></div>
                    <div id="sessionStatus"></div>
                    <div id="userInfoSection" class="hidden">
                        <div id="userInfo" style="font-size: 13px; margin-bottom: 8px;"></div>
                    </div>
                    <div>
                        <button class="btn" onclick="getCacheStatus()">캐시 상태</button>
                        <button class="btn" onclick="clearCache()">캐시 삭제</button>
                    </div>
                    <div id="cacheStatus" class="results"></div>
                </div>
            </div>
        </div>
    </div>

    <script type="module" src="app.js"></script>
</body>
</html>
